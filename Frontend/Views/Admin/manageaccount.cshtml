<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Manage-Account</title>

	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/font-awesome.min.css" rel="stylesheet">
	<link href="/css/datepicker3.css" rel="stylesheet">
	<link href="/css/styles.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="~/js/twbspagination.js"></script>
</head>
<body>
	<nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">BRANIAC</a>
				<ul class="nav navbar-top-links navbar-right">
					<li class="dropdown">
						<a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
							<img src="/imgs/admin-img/notifi.png" width="20" height="20" alt="notifi Icon"><span class="label label-danger">15</span>
						</a>
						<ul class="dropdown-menu dropdown-messages">
							<li>
								<div class="dropdown-messages-box">
									<a href="profile.html" class="pull-left">
										<img alt="image" class="img-circle" src="http://placehold.it/40/30a5ff/fff">
									</a>
									<div class="message-body">
										<small class="pull-right">3 mins ago</small>
										<a href="#"><strong>John Doe</strong> commented on <strong>your photo</strong>.</a>
										<br /><small class="text-muted">1:24 pm - 25/03/2015</small>
									</div>
								</div>
							</li>
							<li class="divider"></li>
							<li>
								<div class="dropdown-messages-box">
									<a href="profile.html" class="pull-left">
										<img alt="image" class="img-circle" src="http://placehold.it/40/30a5ff/fff">
									</a>
									<div class="message-body">
										<small class="pull-right">1 hour ago</small>
										<a href="#">New message from <strong>Jane Doe</strong>.</a>
										<br /><small class="text-muted">12:27 pm - 25/03/2015</small>
									</div>
								</div>
							</li>
							<li class="divider"></li>
							<li>
								<div class="all-button">
									<a href="#">
										<em class="fa fa-inbox"></em> <strong>All Messages</strong>
									</a>
								</div>
							</li>
						</ul>
					</li>
					<li class="dropdown">
						<a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
							<img src="/imgs/admin-img/message.png" width="20" height="20" alt="notifi Icon"><span class="label label-info">5</span>
						</a>
						<ul class="dropdown-menu dropdown-alerts">
							<li>
								<a href="#">
									<div>
										<em class="fa fa-envelope"></em> 1 New Message
										<span class="pull-right text-muted small">3 mins ago</span>
									</div>
								</a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="#">
									<div>
										<em class="fa fa-heart"></em> 12 New Likes
										<span class="pull-right text-muted small">4 mins ago</span>
									</div>
								</a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="#">
									<div>
										<em class="fa fa-user"></em> 5 New Followers
										<span class="pull-right text-muted small">4 mins ago</span>
									</div>
								</a>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</div><!-- /.container-fluid -->
	</nav>
	<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">
		<div class="profile-sidebar">
			<div class="profile-userpic">
				<img src="/imgs/admin-img/male-user.png" width="40" height="40" alt="admin Icon">
			</div>
			<div class="profile-usertitle">
				<div class="profile-usertitle-name">Admin</div>
				<div class="profile-usertitle-status"><span class="indicator label-success"></span>Online</div>
			</div>
			<div class="clear"></div>
		</div>
		<div class="divider"></div>		
		<ul class="nav menu">
			<li><a style="font-size:small" href="/admin/manageaccount"><img src="/imgs/admin-img/acc.png" width="20" height="20" alt="acc Icon">&nbsp; Manage Account </a></li>
			<li><a style="font-size:small" href="/admin/managecourse"><img src="/imgs/admin-img/course.png" width="20" height="20" alt="course Icon">&nbsp; Manage Courses </a></li>
			<li><a style="font-size:small" href="/admin/reportedcomment"><img src="/imgs/admin-img/reported.png" width="20" height="20" alt="reported Icon">&nbsp;Reported Comments</a></li>
			<li><a style="font-size:small" href="/admin/login"><img src="/imgs/admin-img/logout.png" width="20" height="20" alt="logout Icon">&nbsp; Logout</a></li>
		</ul>
	</div><!--/.sidebar-->

	<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">
		<div class="col-sm-6" style="width:40%;padding-top: 20px;">
			<div class="form-group">
				<form role="search">
					<div class="form-group">
						<input type="text" id="searchText" class="form-control" placeholder="Search">
					</div>
					<button type="button" id="searchButton" class="btn btn-primary">Search</button>
				</form>
			</div>

		</div>
		<div class="col-sm-12">
			<table class="table" id="userTable">
				<thead>
					<tr>
						<th>User ID</th>
						<th>User Name</th>
						<th>Email</th>
						<th>Role</th>
						<th>Status</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
			<div id="pagination-buttons" class="text-center">
				<button id="prevPageBtn" class="btn btn-primary">Previous</button>

				<!-- Nút Next -->
				<button id="nextPageBtn" class="btn btn-primary">Next</button>
			</div><!--/.main-->
		</div>
		
	</div>
	
	<script>
		$(document).ready(function () {
			var currentPage = 1;
			var rowsPerPage = 10;
			var usersData; // Biến để lưu trữ dữ liệu người dùng
			
			// Hàm hiển thị người dùng trên trang hiện tại
			function displayUsersOnCurrentPage() {
				var startIndex = (currentPage - 1) * rowsPerPage;
				
				var endIndex = startIndex + rowsPerPage;
				var paginatedUsers = usersData.slice(startIndex, endIndex);

				$('#userTable tbody').empty(); // Xóa nội dung trong tbody trước khi thêm dữ liệu mới

				$.each(paginatedUsers, function (index, user) {
					var status = user.isActive == 1 ? "Active" : "Unactive";
					console.log(endIndex);
					var row = '<tr>' +
						'<td>' + user.userId + '</td>' +
						'<td>' + user.userName + '</td>' +
						'<td>' + user.email + '</td>' +
						'<td>' + (user.role ? user.role.roleName : '') + '</td>' +
						'<td>' + status + '</td>' +
						'<td><a href="detailaccount" class="detailLink" data-userid="' + user.userId + '">Detail</a></td>' +
						'</tr>';
					$('#userTable tbody').append(row);
				});

				$('.detailLink').on('click', function (event) {
					event.preventDefault();
					var userId = $(this).data('userid');
					window.location.href = 'detailaccount?id=' + userId;
				});
			}

			// AJAX request để lấy dữ liệu người dùng
			$.ajax({
				url: 'http://localhost:5020/Admin/ManageUser/GetAllUsers',
				method: 'GET',
				dataType: 'json',
				success: function (data) {
					usersData = data;
					displayUsersOnCurrentPage(); // Hiển thị dữ liệu người dùng ban đầu
				},
				error: function () {
					console.error('Error fetching data from the API');
				}
						
				
			});

			// Previous page button click event
			$('#prevPageBtn').click(function () {
				if (currentPage > 1) {
					currentPage--;
					displayUsersOnCurrentPage();
				}
			});

			// Next page button click event
			$('#nextPageBtn').click(function () {
				var totalPages = Math.ceil(usersData.length / rowsPerPage);
				if (currentPage < totalPages) {
					currentPage++;
					displayUsersOnCurrentPage();
				}
			});
			$('#searchButton').click(function () {
				var searchText = $('#searchText').val(); // Lấy giá trị từ ô nhập liệu tìm kiếm
				// Gửi yêu cầu AJAX đến API với giá trị tìm kiếm
				$.ajax({
					url: 'http://localhost:5020/Admin/ManageUser/GetAllUsers?searchText=' + searchText,
					method: 'GET',
					dataType: 'json',
					success: function (data) {
						usersData = data;
						displayUsersOnCurrentPage(); // Hiển thị dữ liệu khóa học tìm kiếm
					},
					error: function () {
						location.reload();
						console.error('Error fetching data from the API');
					}
				});
			});
		});
    </script>

	<script src="/js/jquery-1.11.1.min.js"></script>
	<script src="/js/bootstrap.min.js"></script>
	<script src="/js/chart.min.js"></script>
	<script src="/js/chart-data.js"></script>
	<script src="/js/easypiechart.js"></script>
	<script src="/js/easypiechart-data.js"></script>
	<script src="/js/bootstrap-datepicker.js"></script>
	<script src="/js/custom.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>


	<script src="~/js/auth/api.js"></script>
	<script>

		function checkCUrrentRoleDm(roleCheck) {
			var AC_exist = false;
			const cookies = document.cookie.split(';');
			for (let i = 0; i < cookies.length; i++) {
				const cookie = cookies[i].trim();
				if (cookie.startsWith("web-at=")) {
					AC_exist = true;
					var tk = cookie.substring(7);
					fetch("http://localhost:5020/api/User/CurrentUser", {
						headers: { Authorization: `Bearer ${tk}` },
					})
						.then((response) => response.json())
						.then((data) => {
							role = data.role;
							if (role != null && role != undefined) {
								return roleCheck == role
							}
						});
				}
			}
			if (!AC_exist) {
				getAccessToken();
			}
			for (let i = 0; i < cookies.length; i++) {
				const cookie = cookies[i].trim();
				if (cookie.startsWith("web-at=")) {
					AC_exist = true;
					var tk = cookie.substring(7);
					fetch("http://localhost:5020/api/User/CurrentUser", {
						headers: { Authorization: `Bearer ${tk}` },
					})
						.then((response) => response.json())
						.then((data) => {
							role = data.role;
							if (role != null && role != undefined) {
								return roleCheck == role
							}
						});
				}
			}
			return false;
		}
		if (!checkCUrrentRoleDm("Admin")) {
			window.location.href = "/";
		}
	</script>


</body>
</html>